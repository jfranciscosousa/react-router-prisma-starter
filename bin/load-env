#!/bin/sh

# Environment loading utility - prevents duplicate loading
# Usage: . bin/load-env [env-file]
# Default: loads .env for regular scripts, .env.test for test scripts

# Check if environment is already loaded to prevent conflicts
if [ -n "${ENV_LOADED:-}" ]; then
    echo "Already loaded env file previously"
    return 0 2>/dev/null || exit 0
fi

# Determine which env file to use
ENV_FILE="${1:-.env}"

# Special handling for test scripts - use .env.test by default
case "$(basename "${0}")" in
    test-*)
        ENV_FILE="${1:-.env.test}"
        ;;
esac

# Load environment if file exists
if [ -f "$ENV_FILE" ]; then
    echo "üìù Loading environment from: $ENV_FILE"

    # Export all variables from the env file
    eval "$(bin/dotenv -f "$ENV_FILE" export)"

    # Mark environment as loaded
    export ENV_LOADED="$ENV_FILE"
else
    echo "‚ö†Ô∏è  Environment file not found: $ENV_FILE"
    # Still mark as loaded to prevent repeated attempts
    export ENV_LOADED="none"
fi